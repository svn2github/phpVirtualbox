<!-- 

	Panes for new hard disk wizard. Logic in vboxWizard()
	Copyright (C) 2011 Ian Moore (imoore76 at yahoo dot com)
	
	$Id$

 -->
<!-- Step 1 -->
<div id='wizardCopyHDStep1' title='Welcome to the virtual disk copying wizard' style='display: none'>
	
	<span class='translate'>copyHD Step1 Message1</span>
	
	<p class='vboxWizButtonsMessage'>wizard buttons message</p>
	
	<p class='translate'>copyHD Step1 Message3</p>

	<span class='vboxTableLabel translate'>Virtual disk to copy</span>
	<div class='vboxBordered'>
		<table class='vboxOptions'>
			<tr style='vertical-align: top;'>
				<td><select id="copyHDDiskSelectId" name="copyHDDiskSelect" onchange='wizardCopyHDUpdateName(this)'></select></td>
				<td style='width:1%' id='newVMDiskVMM'></td>
			</tr>
		</table>
	</div>
	<input type='hidden' name='wizardCopyHDSizeValue' />
</div>


<!-- Step 2 -->
<div id='wizardCopyHDStep2' title='Virtual disk file type' style='display: none'>

	<p class='translate'>copyHD Step2 Message1</p>

	<span class='vboxTableLabel translate'>File Type</span>
	<div class='vboxBordered'>
		<table class='vboxOptions'>
			<tr style='vertical-align: top;'>
				<td><input type='radio' class='vboxRadio' checked='checked' name='copyHDFileType' value='vdi' /> <span class='translate'>VDI (VirtualBox Disk Image)</span></td>
			</tr>
			<tr style='vertical-align: top;'>
				<td><input type='radio' class='vboxRadio' name='copyHDFileType' value='vmdk' /> <span class='translate'>VMDK (Virtual Machine Disk)</span></td>
			</tr>
			<tr style='vertical-align: top;'>
				<td><input type='radio' class='vboxRadio' name='copyHDFileType' value='vhd' /> <span class='translate'>VHD (Virtual Hard Disk)</span></td>
			</tr>
			
		</table>
	</div>
	
</div>


<!-- Step 3 -->
<div id='wizardCopyHDStep3' title='Virtual disk storage details' style='display: none'>
	<span class='translate'>newDisk Step2 Message1</span>
	
	<p class='translate'>newDisk Step2 dynamic</p>
	
	<p class='translate'>newDisk Step2 fixed</p>
	
	<span class='vboxTableLabel translate'>Storage detail</span>
	<div class='vboxBordered'>
		<table class='vboxOptions'>
			<tr style='vertical-align: top;'>
				<td><input type='radio' class='vboxRadio' checked='checked' name='newHardDiskType' value='dynamic' /><span class='translate'>Dynamically allocated</span></td>
			</tr>
			<tr style='vertical-align: top;'>
				<td><input type='radio' class='vboxRadio' name='newHardDiskType' value='fixed' /><span class='translate'>Fixed size</span></td>
			</tr>	
		</table>
	</div>
</div>

<!-- Step 4 -->
<div id='wizardCopyHDStep4' title='Virtual disk file location' style='display: none'>

	<div class='translate'>copyHD Step4 Message1</div>
	
	<span class='vboxTableLabel translate'>Location</span>
	<div class='vboxBordered'>
		<table class='vboxOptions'>
			<tr>
				<td style='width: 100%; white-space: nowrap'>
					<input type='text' class='vboxText' name='wizardCopyHDLocation' style='width: 100%'/>
				</td>
				<td style='width: auto; white-space: nowrap;' class='vboxFileFolderInput'>
					<input type="button" class="vboxImgButton" style="background-image: url(images/vbox/select_file_16px.png)" onClick="wizardCopyHDBrowseLocation()" />
				</td>
			</tr>
		</table>
	</div>	

</div>

<!-- Step 5 -->
<div id='wizardCopyHDStep5' title='Summary' style='display: none'>

	<div class='translate'>copyHD Step5 Message1</div>
	
	<div style='padding: 4px; margin: 2px;' class='vboxBordered'>
		<table class='vboxVertical' style='padding: 4px;'>
			<tr>
				<th style='text-align: right'><span class='translate'>File type</span>:</th>
				<td id='wizardCopyHDTypeLabel'>Dynamically expanding storage</td>
			</tr>
			<tr>
				<th style='text-align: right'><span class='translate'>Details</span>:</th>
				<td id='wizardCopyHDDetailsLabel'>Dynamically expanding storage</td>
			</tr>			
			<tr>
				<th style='text-align: right'><span class='translate'>Location</span>:</th>
				<td id='wizardCopyHDLocationLabel'></td>
			</tr>
			<tr>
				<th style='text-align: right'><span class='translate'>Size</span>:</th>
				<td id='wizardCopyHDSizeLabel'></td>
			</tr>		
		</table>
	</div>
	<p class='translate'>newDisk Step4 Message2</p>

</div>

<script type='text/javascript'>

var sButtons = new Array(
		{
			/* Add Attachment Button */
			'name' : 'mselecthdbtn',
			'label' : 'Choose a virtual hard disk file...',
			'icon' : 'select_file',
			'click' : function () {
				vboxMedia.actions.choose(null,'HardDisk',function(med){
					if(med) copyHDFillDisks(med.base);
				});
			}
		}		
);

var wizardCopyHDToolbar = new vboxToolbarSmall(sButtons);
wizardCopyHDToolbar.disabledString = 'dis';
wizardCopyHDToolbar.addButtons('newVMDiskVMM');		

/* Set up disk selection box */
function copyHDFillDisks(sel) {

	document.forms['frmwizardCopyHD'].copyHDDiskSelect.options.length = 0;
	$(document.forms['frmwizardCopyHD'].copyHDDiskSelect).children().remove();
		
	var s = vboxMedia.mediaForAttachmentType('HardDisk');
	
	// Sort media
	s.sort(function(a,b){return strnatcasecmp(a.name,b.name);});
	
	var mediumSelects = [];
	for(var i = 0; i < s.length; i++) {
		document.forms['frmwizardCopyHD'].copyHDDiskSelect.options[i] = new Option(vboxMedia.mediumPrint(s[i]),s[i].id);
		if(s[i].readOnly && s[i].deviceType == 'HardDisk') $(document.forms['frmwizardCopyHD'].copyHDDiskSelect.options[i]).addClass('vboxMediumReadOnly');
		mediumSelects[i] = {'attachedId':s[i].id,'id':s[i].id,'base':s[i].base,'label':vboxMedia.mediumPrint(s[i])};
	}
	if(sel) {
		$(document.forms['frmwizardCopyHD'].copyHDDiskSelect).val(sel);
	}
	
	$(document.forms['frmwizardCopyHD'].copyHDDiskSelect).mediumselect({'type':'HardDisk','showdiff':false,'media':mediumSelects});

}
copyHDFillDisks();

/* Browse for new disk location */
function wizardCopyHDBrowseLocation() {

	// Get current location
	var loc = document.forms['frmwizardCopyHD'].elements.wizardCopyHDLocation.value;
	var os = null;
	if(loc.indexOf(':') > 0) {
		// windows
		loc = loc.replace(/.*\\/,'');
		os = 'win';
	} else if(loc.indexOf('/') != -1) {
		// *nix
		loc = loc.replace(/.*\//,'');
		os = 'unix';
	} else {
		// no path set
		loc = $('#vboxIndex').data('vboxSystemProperties').homeFolder;
	}
		
	vboxFileBrowser(loc,function(f){
		if(!f) return;
		// get file name
		file = document.forms['frmwizardCopyHD'].elements.wizardCopyHDLocation.value;
		document.forms['frmwizardCopyHD'].elements.wizardCopyHDLocation.value = f+$('#vboxIndex').data('vboxConfig').DSEP+file;
	},true);

}

/* Update new HD name */
function wizardCopyHDUpdateName(sel) {
	var n = $(sel).val();
	var m = vboxMedia.getMediumById(n);
	if(!m) return;
	document.forms['frmwizardCopyHD'].elements.wizardCopyHDLocation.value = trans('%s_copy').replace('%s',m.name.replace(/\.[^\.]+?$/,''));
	document.forms['frmwizardCopyHD'].elements.wizardCopyHDSizeValue.value = m.logicalSize;
}

 /* Suggested Data exists */
$('#wizardCopyHDStep1').bind('show',function(e,wiz){

	// Already initialized?
	if($('#wizardCopyHDStep1').data('init')) return;

	
    if(wiz && wiz.suggested && wiz.suggested.medium)
    	$(document.forms['frmwizardCopyHD'].copyHDDiskSelect).mediumselect({'selectMedium':wiz.suggested.medium});
    
    $('#wizardCopyHDStep1').find('.vboxWizButtonsMessage').html(function(i,e){return e.replace('%1',trans('Next')).replace('%2',trans('Bck')).replace('%3',trans('Cancel'));});
    
	$('#wizardCopyHDStep1').data('init',true);
	
});

/* When showing summary */
$('#wizardCopyHDStep5').bind('show',function(){

	var format = document.forms['frmwizardCopyHD'].elements['copyHDFileType'];
	for(var i = 0; i < format.length; i++) {
		if(format[i].checked) {
			format=format[i].value;
			break;
		}
	}
	// Type (Format) label
	$('#wizardCopyHDTypeLabel').html(vboxMedia.getFormat({'format':format}));

	// Details label
	$('#wizardCopyHDDetailsLabel').html((document.forms['frmwizardCopyHD'].elements.newHardDiskType[1].checked ? trans('Fixed size storage') : trans('Dynamically allocated storage')));

	var loc = document.forms['frmwizardCopyHD'].elements.wizardCopyHDLocation.value;
	if(loc.search(/[\/|\\]/) < 0) {
		if($('#wizardCopyHDStep4').data('suggestedpath'))
			loc = $('#wizardCopyHDStep4').data('suggestedpath') + loc;
		else
			loc = $('#vboxIndex').data('vboxSystemProperties').homeFolder + $('#vboxIndex').data('vboxConfig').DSEP + loc;
	}
	
	if(loc.substring(loc.length-format.length-1).toLowerCase() != '.' + format) loc += '.' + format;
	
	$('#wizardCopyHDLocationLabel').html($('<div />').text(loc).html());

	// Fix size if we need to
	var mbytes = vboxConvertMbytes(document.forms['frmwizardCopyHD'].elements.wizardCopyHDSizeValue.value);
	document.forms['frmwizardCopyHD'].elements.wizardCopyHDSizeValue.value = vboxMbytesConvert(mbytes);
	$('#wizardCopyHDSizeLabel').html(document.forms['frmwizardCopyHD'].elements.wizardCopyHDSizeValue.value + ' ('+mbytes+' '+trans('MB')+')');
});
 
</script>
