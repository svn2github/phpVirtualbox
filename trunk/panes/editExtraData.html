<!--

	Edit guest properties of a VM

	Copyright (C) 2010-2013 Ian Moore (imoore76 at yahoo dot com)

	$Id$ 
	
-->
<div id='vboxVMExtraData' class='vboxBordered'>
	<img src='images/spinner.gif' />
</div>
<script type='text/javascript'>

function vboxVMExtraDataLoad() {
	
	$('#vboxVMExtraData').empty().append("<img src='images/spinner.gif' />");
	
	$.when(vboxAjaxRequest('machineEnumerateGuestProperties',{'vm':vboxChooser.getSingleSelectedId(),'pattern':'*'})).done(function(d){
		
		$('#vboxVMExtraData').empty();
		
		// Add table
		$('<table />').attr({'class':'vboxHorizontal'}).append(
				$('<thead />').append(
						$('<tr />')
							.append($('<th />').attr({'style':'width:50%'}).html('Key'))
							.append($('<th />').attr({'colspan':'2'}).html('Value'))
				)
		).append(
			$('<tbody />').attr({'id':'vboxVMExtraDataList'}).append(
				$('<tr />')
					.append(
							$('<td />').append(
									$('<input />').attr({'id':'vboxVMExtraDataAddKey','type':'text','class':'vboxText','style':'width:99%'})
										
								)
					).append(				
							$('<td />').append($('<input />').attr({'id':'vboxVMExtraDataAddVal','type':'text','class':'vboxText','style':'width:99%'}))
					).append(
							$('<td />').attr({'style':'text-align:center;width:1%;'}).append(
								$('<input />').attr({'type':'button','class':'vboxText','style':'background-image:url(images/vbox/controller_add_16px.png)'})
								.click(function(){
											vboxVMExtraDataAdd();
								})
							)
					)
			)
		).appendTo($('#vboxVMExtraData'));
		
		if(d && d.responseData && d.responseData[0] && d.responseData[0][0]) {
			for(var i = 0; i < d.responseData[0].length; i++) {
				
				var editable = d.responseData[3][i].indexOf("RDONLY") == -1;
				
				$('<tr />')
				.addClass((i % 2 == 0 ? '' : 'vboxOddRow'))
				.append(
					$('<td />').addClass('vboxGuestPropertyName').html(d.responseData[0][i])
				).append(
					$('<td />').append(
							$('<input />').attr({'type':'text','class':'vboxText','style':'width:99%'}).val(d.responseData[1][i])
								.prop('disabled', !(editable))
					)
				).append(
					$('<td />').attr({'style':'text-align:center'}).append(
							(editable ? 
							$('<input />').attr({'type':'button','class':'vboxText','style':'background-image:url(images/vbox/controller_remove_16px.png)'})
								.click(function(){
									vboxVMExtraDataRemove($(this).parent().siblings('.vboxGuestPropertyName').html());
								})
							: '')
					)
				).addClass((d.responseData[3][i].indexOf("RDONLY") > -1 ? 'vboxReadOnly' : ''))
				.appendTo($('#vboxVMExtraDataList'));
			}
		}
	});
	
}

function vboxVMExtraDataAdd() {
	var key = $('#vboxVMExtraDataAddKey').removeClass('vboxRequired').val();
	var val = $('#vboxVMExtraDataAddVal').removeClass('vboxRequired').val();
	
	if(!key) {
		$('#vboxVMExtraDataAddKey').addClass('vboxRequired');
		return;
	}
	
	if(!val) {
		$('#vboxVMExtraDataAddVal').addClass('vboxRequired');
		return;
	}

}


</script>