<!-- 

	Main Tabs
	Copyright (C) 2010-2012 Ian Moore (imoore76 at yahoo dot com)
	
	$Id$

 -->
<div id='tabMainContent' class='vboxInvisible' style='overflow: auto;'></div>
<script type='text/javascript'>

// Create UL
$('#vboxTabsList').append($('<ul />').attr({'id':'tablistMain'}));


var tabs = [
    // Details
    {
    	name:'vboxTabVMDetails',
    	content:'tabVMDetails',
    	label:'Details',
    	icon:'settings'
    	
    // Snapshots
    },{
    	name:'vboxTabVMSnapshots',
    	content:'tabVMSnapshots',
    	label:'Snapshots',
    	icon:'take_snapshot',
    	enabled:function(vm){
    		return (vm && vm.id != 'host');
    	},
    	disabled_icon:'take_snapshot_dis'
    	
    // Console
    },{
    	name:'vboxTabVMConsole',
    	content:'tabVMConsole',
    	label:'Console',
    	bindEvents: {
    		'OnVRDEServerInfoChanged' : function(e,vmid,consoleInfo) {
    			
	    		var selVM = vboxChooser.getSingleSelected();	    		
	    		var enabled = (selVM && selVM.id == vmid && vboxVMStates.isRunning(selVM) && consoleInfo && consoleInfo.enabled && consoleInfo.consolePort > 0);
	    		
	    		if(enabled) tabsMain.enableTab(tabsMain.getTabByName('vboxTabVMConsole'));
	    		else tabsMain.disableTab(tabsMain.getTabByName('vboxTabVMConsole'));

    		}
    	},
    	icon:'vrdp',
    	enabled:function(vm){
    		return (vm && vm.id != 'host' && vboxVMStates.isRunning(vm) && vm.consoleInfo && vm.consoleInfo.consolePort > 0);
    	}
   	}
];


// Tab object. Defined in this file
var tabsMain = new vboxTabs('tabMainContent');

// Loader that will load our tab panes
var tabLoader = new vboxLoader();

// Load each tab and create tab link
for(var i = 0; i < tabs.length; i++) {

	// Tab disabled?
	if($('#vboxIndex').data('vboxConfig')['disable' + tabs[i].name.substring(4)])
		continue;

	// Tab link
	$('<li />').attr({'class':'ui-corner-all','id':'tabsMain-'+tabs[i].name}).html('<a href="#'+tabs[i].name+'"><span><img style="vertical-align: middle" src="images/vbox/'+tabs[i].icon+'_16px.png" border="0" /> <span id="'+tabs[i].name+'Title">'+trans(tabs[i].label,'UIVMDesktop')+'</span></span></a>').appendTo('#tablistMain');
	
	tabLoader.addFileToDOM('panes/'+tabs[i].content+'.html',$('#tabMainContent'));
	
}

// Once tabs are loaded run this..
tabLoader.onLoad = function(){

	for(var i = 0; i < tabs.length; i++) {

		// Tab disabled?
		if($('#vboxIndex').data('vboxConfig')['disable' + tabs[i].name.substring(4)])
			continue;

		tabsMain.addTab(tabs[i]);
		
		// Bind events
		if(tabs[i].bindEvents) {
			
			for(var a in tabs[i].bindEvents) {
				
				if(typeof(a) != 'string') continue;
				
				$('#vboxIndex').bind(a,tabs[i].bindEvents[a]);
			}
		}
		
	}
	
	$('#vboxIndex').bind('vmSelectionListChanged',tabsMain.updateTabs)
		.bind('vmLoading',tabsMain.updateTabs)
		.bind('vmLoaded',tabsMain.updateTabs);

	// Add "click" functionality to each tab
	$('#tablistMain').children().click(function(){
		if(!$(this).hasClass('vboxDisabled'))
			tabsMain.showTab($(this).children().first().attr('href'));
		return false;
		
	// Mouseover
	}).hover(function(){
		if($(this).hasClass('vboxDisabled')) return false;
		$(this).addClass('hover');
	},function(){
		$(this).removeClass('hover');
	});

	// Initial update of tabs
	tabsMain.updateTabs();


};
tabLoader.run();

/*
 * Tabs pane JavaScript code for main tabs. This
 * class listens for a vmlist selection change and tells
 * the tabs to update themselves with new data
 * 
 */

function vboxTabs(id) {

	var self = this;
	this.ref = null;
	this.vm = null;
	this.tabs = new Array();
	this.tabSelected = null;
	this.id = id;
	
	// Add a tab to list
	this.addTab = function (tab) {
		if(!this.tabSelected) {
			this.tabSelected = '#'+tab.name;
			$('#tablistMain').find('a[href=#'+tab.name+']').parent().addClass('selected');
		}
		this.tabs[this.tabs.length] = tab;
	};
	
	// Get a tab by name
	this.getTabByName = function(name) {
		for(var i = 0; i < self.tabs.length; i++) {
			if(self.tabs[i].name == name) return self.tabs[i];
		}
	};
	
	// Show a tab
	this.showTab = function (tab) {
		
		// Do nothing if it is already shown
		if(self.tabSelected == tab) return;
		
		// Hide each tab
		for(var i = 0; i < self.tabs.length; i++) {
			$('#'+self.tabs[i].name).css({'display':'none'}).trigger('hide');
		}
		
		// Show tab
		$(''+tab).css('display','').trigger('show');
		self.tabSelected = tab;
		$('#tablistMain').children().removeClass('selected');
		$('#tablistMain').find('a[href='+tab+']').parent().addClass('selected');

		
	};

	// Update (disable/enable) tabs
	this.updateTabs = function() {
		
		var vm = null;
		
		if(vboxChooser) vm = vboxChooser.getSingleSelected();
		
		for(var i = 0; i < self.tabs.length; i++) {
			
			// No enable test? Skip
			if(!self.tabs[i].enabled) continue;
			
			// Disable non-multiSelect tabs if more than one
			// item is selected or if it fails the "enabled" test
			if(!vboxChooser || vboxChooser.selectionMode != vboxSelectionModeSingleVM ||
					!self.tabs[i].enabled(vm)) {
				
				self.disableTab(self.tabs[i]);
				
				
			} else {
				self.enableTab(self.tabs[i]);
			}
		}		
		$(''+self.tabSelected).trigger('show',[vm]);
	};
		
	this.disableTab = function(tab) {
		
		// Was this tab selected?
		if(self.tabSelected == '#'+tab.name)
			self.showTab('#'+self.tabs[0].name);

		$('#tabsMain-'+tab.name).addClass('vboxDisabled').find('img').attr('src','images/vbox/'+(tab.disabled_icon ? tab.disabled_icon : tab.icon+'_disabled')+'_16px.png');
	};
	
	this.enableTab = function(tab) {
		$('#tabsMain-'+tab.name).removeClass('vboxDisabled').find('img').attr('src','images/vbox/'+tab.icon+'_16px.png');
	};

}

</script>

